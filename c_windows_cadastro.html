<!DOCTYPE html>
<html lang="pt_BR>
<head>
    <title>Wagner Marcuci Software C/C++</title>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
</head>
<body style="background-color:black; color:white;" alink="white" link="white" vlink="white">
<h2 style="border: 1px solid white;width:230px;padding:5px;">&nbsp;&nbsp;Windows Cadastro</h2>
<br/>
<a href="https://www.youtube.com/watch?v=sNx3KBD6Mmg" 
style="font-family:Candara;text-decoration:none;color:red;">V&iacute;deo do Canal</a>
</br></br>
<pre>
<h3>button_diversos.h</h3>
#ifndef BUTTON_DIVERSOS_H
#define BUTTON_DIVERSOS_H
#include &lt;windows.h&gt;

HWND criar_botao_incluir( HWND, HINSTANCE );
HWND criar_botao_carregar( HWND, HINSTANCE );
HWND criar_botao_limpar( HWND, HINSTANCE );


#endif // BUTTON_DIVERSOS_H

<h3>button_diversos.c</h3>

#include "button_diversos.h"

HWND criar_botao_incluir( HWND p_hwnd, HINSTANCE p_instance )
{
    return CreateWindow(
        TEXT( "BUTTON"),
        TEXT( "Incluir" ),
        WS_CHILD | WS_VISIBLE | BS_NOTIFY,
        30,
        120,
        80,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

}

HWND criar_botao_carregar( HWND p_hwnd, HINSTANCE p_instance )
{
    return CreateWindow(
        TEXT( "BUTTON"),
        TEXT( "Carregar" ),
        WS_CHILD | WS_VISIBLE | BS_NOTIFY,
        120,
        120,
        80,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

}

HWND criar_botao_limpar( HWND p_hwnd, HINSTANCE p_instance )
{
    return CreateWindow(
        TEXT( "BUTTON"),
        TEXT( "Limpar" ),
        WS_CHILD | WS_VISIBLE | BS_NOTIFY,
        210,
        120,
        80,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

}

<h3>edit_diversos.h</h3>
#ifndef EDIT_DIVERSOS_H
#define EDIT_DIVERSOS_H
#include &lt;windows.h&gt;

HWND criar_texto_nome( HWND, HINSTANCE );
HWND criar_texto_idade( HWND, HINSTANCE );
HWND criar_texto_sexo( HWND, HINSTANCE );

#endif // EDIT_DIVERSOS_H

<h3>edit_diversos.c</h3>
#include "edit_diversos.h"

HWND criar_texto_nome( HWND p_hwnd, HINSTANCE p_instance )
{
    return CreateWindow(
        TEXT( "EDIT"),
        TEXT( "" ),
        WS_CHILD | WS_VISIBLE | WS_BORDER | WS_TABSTOP,
        120,
        30,
        200,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

}

HWND criar_texto_idade( HWND p_hwnd, HINSTANCE p_instance )
{
    return CreateWindow(
        TEXT( "EDIT"),
        TEXT( "" ),
        WS_CHILD | WS_VISIBLE | WS_BORDER | WS_TABSTOP,
        120,
        60,
        30,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

}

HWND criar_texto_sexo( HWND p_hwnd, HINSTANCE p_instance )
{
    return CreateWindow(
        TEXT( "EDIT"),
        TEXT( "" ),
        WS_CHILD | WS_VISIBLE | WS_BORDER | WS_TABSTOP,
        120,
        90,
        30,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

}

<h3>funcao_divesos.h</h3>
#ifndef FUNCAO_DIVERSOS_H
#define FUNCAO_DIVERSOS_H

#include &lt;windows.h&gt;

BOOL incluir_registro( char *, int, char );
BOOL carregar_registro( char *, char *, char * );

#endif // FUNCAO_DIVERSOS_H

<h3>funcao_divesos.c</h3>
#include &lt;stdio.h&gt;
#include "funcao_diversos.h"

BOOL incluir_registro( char * p_nome, int p_idade , char p_sexo )
{
    remove( "registro.txt" );

    FILE * arquivo = fopen( "registro.txt", "w" );

    if ( !arquivo )
    {
        return FALSE;
    }

    fprintf( arquivo, "%s\n", p_nome );
    fprintf( arquivo, "%d\n", p_idade );
    fprintf( arquivo, "%c\n", p_sexo );

    fflush( arquivo );
    fclose( arquivo );
    printf( "OK\n" );
    return TRUE;
}


BOOL carregar_registro( char * p_nome, char * p_idade, char * p_sexo )
{
    FILE * arquivo = fopen( "registro.txt", "r" );

    if ( !arquivo )
    {
        return FALSE;
    }

    fgets( p_nome, 30, arquivo );
    fgets( p_idade, 4, arquivo );
    fgets( p_sexo, 2, arquivo );

    p_nome[ strlen( p_nome ) - 1 ] = '\0';
    p_idade[ strlen( p_idade ) - 1 ] = '\0';

    return TRUE;
}

<h3>label_diversos.h</h3>
#ifndef LABEL_DIVERSOS_H
#define LABEL_DIVERSOS_H
#include &lt;windows.h&gt;

BOOL criar_labels( HWND, HINSTANCE );


#endif // LABEL_DIVERSOS_H

<h3>label_diversos.c</h3>
#include "label_diversos.h"

BOOL criar_labels( HWND p_hwnd, HINSTANCE p_instance )
{
    CreateWindow(
        TEXT( "STATIC"),
        TEXT( "Nome" ),
        WS_CHILD | WS_VISIBLE,
        30,
        30,
        80,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

    CreateWindow(
        TEXT( "STATIC"),
        TEXT( "Idade" ),
        WS_CHILD | WS_VISIBLE,
        30,
        60,
        80,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

    CreateWindow(
        TEXT( "STATIC"),
        TEXT( "Sexo" ),
        WS_CHILD | WS_VISIBLE,
        30,
        90,
        80,
        25,
        p_hwnd,
        NULL,
        p_instance,
        NULL
    );

}

<h3>main.c</h3>
#include &lt;windows.h&gt;
#include &lt;stdio.h&gt;
#include &lt;tchar.h&gt;
#include "label_diversos.h"
#include "edit_diversos.h"
#include "button_diversos.h"
#include "funcao_diversos.h"

HINSTANCE g_instance = 0;
HWND g_texto_nome = 0;
HWND g_texto_idade = 0;
HWND g_texto_sexo = 0;

HWND g_botao_incluir = 0;
HWND g_botao_carregar = 0;
HWND g_botao_limpar = 0;

LRESULT CALLBACK WindowProc(HWND hwnd, UINT uMsg, WPARAM wParam, LPARAM lParam)
{
    switch (uMsg)
    {
        case WM_SETFOCUS:
            printf( "WM_SETFOCUS \n" );
            break;

        case WM_ACTIVATE:
            printf( "WM_ACTIVATE \n" );

            if ( criar_labels( hwnd, g_instance ) == FALSE )
            {
                printf( "problema na geracao dos labels\n" );
            }

            g_texto_nome = criar_texto_nome( hwnd, g_instance );

            if ( !g_texto_nome )
            {
                printf( "problema na geracao do texto nome\n" );
            }

            g_texto_idade = criar_texto_idade( hwnd, g_instance );

            if ( !g_texto_idade )
            {
                printf( "problema na geracao do texto idade\n" );
            }

            g_texto_sexo = criar_texto_sexo( hwnd, g_instance );

            if ( !g_texto_sexo )
            {
                printf( "problema na geracao do texto sexo\n" );
            }

            g_botao_incluir = criar_botao_incluir( hwnd, g_instance );

            if ( !g_botao_incluir )
            {
                printf( "problema na geracao do botao incluir\n" );
            }

            g_botao_carregar = criar_botao_carregar( hwnd, g_instance );

            if ( !g_botao_carregar )
            {
                printf( "problema na geracao do botao carregar\n" );
            }

            g_botao_limpar = criar_botao_limpar( hwnd, g_instance );

            if ( !g_botao_limpar )
            {
                printf( "problema na geracao do botao limpar\n" );
            }

            break;

        case WM_CREATE:
            printf( "WM_CREATE \n" );
            break;

        case WM_SIZE:
            printf( "WM_SIZE \n" );
            break;

        case WM_MOVE:
    //        printf( "WM_MOVE \n" );
            break;

        case WM_LBUTTONDOWN:
            printf( "WM_LBUTTONDOWN \n" );
            break;

        case WM_LBUTTONUP:
            printf( "WM_LBUTTONUP \n" );
            break;

        case WM_COMMAND:
            if ( lParam == g_botao_incluir )
            {
                WORD acao = HIWORD( wParam );

                if ( acao == BN_CLICKED )
                {
                    char nome [ 30 + 1 ] = "";
                    char cIdade[ 4 + 1 ] = "";
                    int idade = 0;
                    char sexo[ 1 + 1 ] = "";

                    SendMessageA( g_texto_nome, WM_GETTEXT, (WPARAM)sizeof( nome ), (LPARAM)nome );
                    SendMessageA( g_texto_idade, WM_GETTEXT, (WPARAM)sizeof( cIdade ), (LPARAM)cIdade );
                    SendMessageA( g_texto_sexo, WM_GETTEXT, (WPARAM)sizeof( sexo ), (LPARAM)sexo );

                    idade = atoi( cIdade );

                    if ( incluir_registro( nome, idade, sexo[ 0 ] ) == FALSE )
                    {
                        printf( "erro na gravacao do arquivo\n" );
                    }
                    else
                    {
                        SendMessageA( g_texto_nome, WM_SETTEXT, 0, "" );
                        SendMessageA( g_texto_idade, WM_SETTEXT, 0, "" );
                        SendMessageA( g_texto_sexo, WM_SETTEXT, 0, "" );
                    }
                }
            }

            if ( lParam == g_botao_carregar )
            {
                WORD acao = HIWORD( wParam );

                if ( acao == BN_CLICKED )
                {
                    char nome [ 30 + 1 ] = "";
                    char cIdade[ 4 + 1 ] = "";
                    char sexo[ 1 + 1 ] = "";

                    if ( carregar_registro( &nome, &cIdade, &sexo ) == FALSE )
                    {
                        printf( "erro na carga\n" );
                    }
                    else
                    {
                        SendMessageA( g_texto_nome, WM_SETTEXT, 0, nome );
                        SendMessageA( g_texto_idade, WM_SETTEXT, 0, cIdade );
                        SendMessageA( g_texto_sexo, WM_SETTEXT, 0, sexo );
                    }
                }

            }

            if ( lParam == g_botao_limpar )
            {
                WORD acao = HIWORD( wParam );

                if ( acao == BN_CLICKED )
                {
                    SendMessageA( g_texto_nome, WM_SETTEXT, 0, (LPARAM)"" );
                    SendMessageA( g_texto_idade, WM_SETTEXT, 0, "" );
                    SendMessageA( g_texto_sexo, WM_SETTEXT, 0, "" );
                }
            }
            break;

        case WM_RBUTTONDOWN:
            printf( "WM_RBUTTONDOWN \n" );
            break;

        case WM_RBUTTONUP:
            printf( "WM_RBUTTONUP \n" );
            break;

        case WM_PAINT:
            {
                printf( "WM_PAINT \n" );

                PAINTSTRUCT ps;
                BeginPaint( hwnd, &ps );
                EndPaint( hwnd, &ps );
                return 0;
            }

        case WM_DESTROY:
            printf( "WM_DESTROY \n" );
            PostQuitMessage(0);
            return 0;
    }

    return DefWindowProc(hwnd, uMsg, wParam, lParam);
}


INT WINAPI WinMain(HINSTANCE hInstance, HINSTANCE hPrevInstance, PSTR lpCmdLine, INT nCmdShow)
{
    const char * CLASS_NAME  = TEXT("CLASSE_WINDOWS");
    g_instance = hInstance;

    WNDCLASS wc = { };

    wc.lpfnWndProc   = WindowProc;
    wc.hInstance     = hInstance;
    wc.lpszClassName = CLASS_NAME;

    RegisterClass(&wc);

     //Create the window.

    HWND hwnd = CreateWindowEx(
        0,
        CLASS_NAME,
        TEXT("Janela Windows"),
        WS_OVERLAPPEDWINDOW,
        CW_USEDEFAULT, // x position
        CW_USEDEFAULT, // y position
        1000, // witdh
        500, // height
        NULL,
        NULL,
        hInstance,
        NULL
        );

    if (hwnd == NULL)
    {
        return 0;
    }

    ShowWindow(hwnd, nCmdShow);

     //Run the message loop.

    MSG msg = { };

    while (GetMessage(&msg, NULL, 0, 0))
    {
        TranslateMessage(&msg);
        DispatchMessage(&msg);
    }

    return 0;
}

</pre>
</body>
</html>
